{% extends "admin/base.html" %}
{% block title %}Einstellungen - {{ brand_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Einstellungen</h1>
</div>

<div class="card">
    <div class="card-header">Unternehmensdaten</div>
    <form method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="display_name">Anzeigename / Markenname</label>
            <input type="text" id="display_name" name="display_name"
                   value="{{ settings.display_name or '' }}"
                   placeholder="{{ settings.business_name }}">
            <small class="help-text">Wird auf der Website (Titel, Navigation) angezeigt. Leer = Firmenname wird verwendet.</small>
        </div>

        <div class="form-group">
            <label for="business_name">Firmenname</label>
            <input type="text" id="business_name" name="business_name"
                   value="{{ settings.business_name }}" required>
            <small class="help-text">Wird auf PDFs (Angebote, Rechnungen) verwendet.</small>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="address_lines">Adresse</label>
                <textarea id="address_lines" name="address_lines" rows="3"
                          placeholder="Straße Nr.&#10;PLZ Ort">{{ settings.address_lines or '' }}</textarea>
            </div>
            <div class="form-group">
                <label for="contact_lines">Kontakt</label>
                <textarea id="contact_lines" name="contact_lines" rows="3"
                          placeholder="Tel: ...&#10;E-Mail: ...">{{ settings.contact_lines or '' }}</textarea>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="bank_lines">Bankverbindung</label>
                <textarea id="bank_lines" name="bank_lines" rows="3"
                          placeholder="IBAN: ...&#10;BIC: ...&#10;Bank: ...">{{ settings.bank_lines or '' }}</textarea>
            </div>
            <div class="form-group">
                <label for="tax_number">Steuernummer</label>
                <input type="text" id="tax_number" name="tax_number"
                       value="{{ settings.tax_number or '' }}"
                       placeholder="z.B. 12/345/67890">
                <div class="mt-6">
                    <label for="vat_id">USt-IdNr.</label>
                    <input type="text" id="vat_id" name="vat_id"
                           value="{{ settings.vat_id or '' }}"
                           placeholder="z.B. DE123456789">
                </div>
            </div>
        </div>

        <hr class="section-divider">

        <div class="card-header">Steuer-Einstellungen</div>

        <div class="form-row">
            <div class="form-group">
                <label for="tax_mode">Besteuerungsart</label>
                <select id="tax_mode" name="tax_mode">
                    <option value="kleinunternehmer" {{ 'selected' if settings.tax_mode == 'kleinunternehmer' }}>
                        Kleinunternehmer (§ 19 UStG)
                    </option>
                    <option value="regular" {{ 'selected' if settings.tax_mode == 'regular' }}>
                        Regelbesteuerung
                    </option>
                </select>
            </div>
            <div class="form-group">
                <label for="tax_rate">Regelsteuersatz (%)</label>
                <input type="number" id="tax_rate" name="tax_rate" step="0.1"
                       value="{{ settings.tax_rate }}" style="width: 120px;">
            </div>
            <div class="form-group">
                <label for="tax_rate_reduced">Ermäßigter Satz (%)</label>
                <input type="number" id="tax_rate_reduced" name="tax_rate_reduced" step="0.1"
                       value="{{ settings.tax_rate_reduced or 7.0 }}" style="width: 120px;">
            </div>
        </div>

        <hr class="section-divider">

        <div class="card-header">Favicon</div>

        <div class="form-group">
            <label>Favicon</label>
            {% if settings.favicon_filename %}
                <div class="mb-8">
                    <img src="/favicon.ico" alt="Favicon" style="width: 32px; height: 32px; image-rendering: pixelated;">
                    <br>
                    <small class="text-muted">Aktuell: {{ settings.favicon_filename }}</small>
                </div>
            {% endif %}
            <input type="file" name="favicon" accept="image/png,image/jpeg,image/svg+xml,image/webp,image/gif,image/x-icon">
            <small class="help-text">PNG, JPEG, SVG, WebP, GIF oder ICO. Wird als Browser-Tab-Icon angezeigt.</small>
            {% if settings.favicon_filename %}
                <label class="mt-4 font-normal"><input type="checkbox" name="remove_favicon" value="1"> Favicon entfernen</label>
            {% endif %}
        </div>

        <hr class="section-divider">

        <div class="card-header">Logo (PDF)</div>

        <div class="form-group">
            <label>Firmenlogo für PDF-Dokumente</label>
            {% if settings.logo_filename %}
                <div class="mb-8">
                    <img src="{{ url_for('admin.uploaded_file', filename=settings.logo_filename) }}" alt="Logo" style="max-height: 60px;">
                    <br>
                    <small class="text-muted">Aktuell: {{ settings.logo_filename }}</small>
                </div>
            {% endif %}
            <input type="file" name="logo" accept="image/png,image/jpeg,image/svg+xml,image/webp">
            <small class="help-text">PNG, JPEG, SVG oder WebP. Wird oben rechts auf Angeboten und Rechnungen angezeigt.</small>
            {% if settings.logo_filename %}
                <label class="mt-4 font-normal"><input type="checkbox" name="remove_logo" value="1"> Logo entfernen</label>
            {% endif %}
        </div>

        <hr class="section-divider">

        <div class="card-header">Faktura-Einstellungen</div>

        <div class="form-row">
            <div class="form-group">
                <label for="quote_number_prefix">Angebotsnummer-Präfix</label>
                <input type="text" id="quote_number_prefix" name="quote_number_prefix"
                       value="{{ settings.quote_number_prefix or 'A' }}" style="width: 120px;"
                       placeholder="A">
                <small class="help-text">z.B. A → A-2026-0001</small>
            </div>
            <div class="form-group">
                <label for="invoice_number_prefix">Rechnungsnummer-Präfix</label>
                <input type="text" id="invoice_number_prefix" name="invoice_number_prefix"
                       value="{{ settings.invoice_number_prefix or 'R' }}" style="width: 120px;"
                       placeholder="R">
                <small class="help-text">z.B. R → R-2026-0001</small>
            </div>
            <div class="form-group">
                <label for="default_payment_terms_days">Zahlungsziel (Tage)</label>
                <input type="number" id="default_payment_terms_days" name="default_payment_terms_days"
                       value="{{ settings.default_payment_terms_days or 14 }}" style="width: 120px;"
                       min="0" step="1">
                <small class="help-text">Standard-Zahlungsziel für neue Angebote/Rechnungen</small>
            </div>
        </div>

        <div class="form-group">
            <label for="default_agb_text">Standard-AGB für Angebote</label>
            <textarea id="default_agb_text" name="default_agb_text" rows="6"
                      placeholder="Allgemeine Geschäftsbedingungen ...">{{ settings.default_agb_text or '' }}</textarea>
            <small class="help-text">Wird beim Erstellen neuer Angebote vorausgefüllt, kann pro Angebot angepasst werden.</small>
        </div>

        <hr class="section-divider">

        <button type="submit" class="btn btn-primary">Einstellungen speichern</button>
    </form>
</div>
{% endblock %}
